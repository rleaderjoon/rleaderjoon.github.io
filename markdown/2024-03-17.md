### 함수형 업데이트를 사용함에 있어서 생각해야 하는 부분

```js
const [val, setVal] = useSate("");
const [log, setLog] = useState([]);

setLog(log => [...log, val]);
```

이런 구조가 있다고 할 때 GPT한태 다양한 형태로 질의를 할 때 마다 계속 나의 생각과는 다르게 다음과 같이 코드를 작성해주었다.

```js
setLog(prevLog => [...prevLog, val]);
```

왜 자꾸 다음의 방식을 추천할까 궁금해서 몇가지를 질의해보았다.

--- 

Q. 함수형 업데이트를 사용하면 `prevLog`는 현재 `log`의 상태야?<br>
A. 그렇다. 내부적으로 `prevLog`를 복사하고 새로운 값을 추가한 후 `setLog`를 통해 업데이트합니다.

---

Q. 그럼 이때의 `prevLog`는 완전히 새로운 메모리 영역을 잡아먹는, 즉 단순한 메모리 주소의 복사가 아닌 새로운 배열인건가?<br>
A. 네, 맞습니다. `prevLog`는 현재 상태 값의 참조를 받지만, `[...prevLog, val]`을 통해 새로운 배열이 생성됩니다. 이 새로운 배열은 별도의 메모리 영역을 차지하게 됩니다. 스프레드 연산자(`...`)를 사용하면 기존 배열의 요소들을 새로운 배열로 **복사**합니다.

---

Q. 근데 `setLog(log => [...log, val])`로 한다고 해도 중간에 `log`데이터를 훼손할 여지가 없지않아?

A.
1. **비동기 업데이트**:
    
    - React의 상태는 비동기적으로 업데이트될 수 있습니다. 여러 상태 업데이트가 연달아 발생하면 예상치 못한 상태가 참조될 수 있습니다.
2. **함수형 업데이트의 이점**:
    
    - `prevLog`는 항상 최신 상태 값을 제공하므로, 안전하게 현재 상태를 기반으로 업데이트할 수 있습니다.
    - 여러 업데이트가 동시에 일어나도 각 업데이트가 정확한 상태를 참조합니다.
